<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>OpenMQTT</title>
  <link href="https://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
  <link href="css/doc.css" rel="stylesheet" />
  <link href="css/scheduler.css" rel="stylesheet" />
  <script src="js/jquery-3.5.1.min.js"></script>
  <script src="js/scheduler.js"></script>
  <script src="https://www.gstatic.com/charts/loadeyhr.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
  <link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/superhero/bootstrap.min.css" rel="stylesheet"
    title="main">
</head>

<body>
  <div class="container-fluid">
    <h1><span id="hostname">MQTT sender for ESP32</span> <span class="droite" id="Temps">00:00:00</span></h1>
    <ul class="nav nav-tabs" id="tab">
      <li><a href="#tab_information" data-toggle="tab">INFORMATIONS</a></li>
      <li><a href="#tab_topic" data-toggle="tab">MQTT TOPIC</a></li>
      <li><a href="#tab_configuration" data-toggle="tab">ADVANCED CONFIGURATION</a></li>
    </ul>
    <div class="tab-content">
      <div class="tab-pane fade" id="tab_information">
        <h2>Informations</h2>
        <form action="/get">
          Device's name : <input type="text" name="hostname">
          <input type="submit" value="Submit">
        </form>
        <form action="/get">
          Mycodo IP address : <input type="text" name="mqttip">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="mqttServer">Nothing here</span>
        </form>
      </div>
      <div class="tab-pane fade" id="tab_topic">
        <h2>MQTT Topic (if one topic is filled, the sensor will be activated)</h2>
        <button onclick="ShowAll()">Show all</button>
        <button onclick="Activation_DHT11()">Show DHT11 Topic selection</button>
        <button onclick="Activation_SoilMoisture()">Show Soil Moisture Topic selection</button>
        <div style="display:none;" id="div_DHT11">
          <form action="/get">
            Topic : DHT11 : Temperature : <input type="text" name="DHT11Temperature">
            <input type="submit" value="Submit"><strong> Saved value : </strong><span
              id="Topic_DHT11_Temperature">Nothing
              here</span>
          </form>
          <form action="/get">
            Topic : DHT11 : Humidity : <input type="text" name="DHT11Humidity">
            <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Topic_DHT11_Humidity">Nothing
              here</span>
          </form>
        </div>
        <div style="display:none;" id="div_SoilMoisture">
          <form action="/get">
            Topic : Soil Moisture : <input type="text" name="SoilMoisture">
            <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Topic_SoilMoisture">Nothing
              here</span>
          </form>
        </div>
      </div>
      <div class="tab-pane fade" id="tab_configuration">
        <h2>Advanced Configuration <span class="droite" id="InternalTemp">0 °C</span></h2>
        <div class="btn-group">
          <button class="btn btn-default" id="labelTheme">Theme</button>
          <button class="btn btn-default dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button>
          <ul class="dropdown-menu">
            <li><a class="change-style-menu-item" href="#" rel="bootstrap">Classique</a></li>
            <li><a class="change-style-menu-item" href="#" rel="flatly">Flatly</a></li>
            <li><a class="change-style-menu-item" href="#" rel="cerulean">Cerulean</a></li>
            <li><a class="change-style-menu-item" href="#" rel="cosmo">Cosmo</a></li>
            <li><a class="change-style-menu-item" href="#" rel="journal">Journal</a></li>
            <li><a class="change-style-menu-item" href="#" rel="paper">Paper</a></li>
            <li><a class="change-style-menu-item" href="#" rel="readable">Grossi</a></li>
            <li><a class="change-style-menu-item" href="#" rel="sandstone">Sandstone</a></li>
            <li><a class="change-style-menu-item" href="#" rel="simplex">Simplex</a></li>
            <li><a class="change-style-menu-item" href="#" rel="spacelab">Spacelab</a></li>
            <li><a class="change-style-menu-item" href="#" rel="united">United</a></li>
            <li><a class="change-style-menu-item" href="#" rel="yeti">Yeti </a></li>
          </ul>
        </div>
        <form action="/get">
          Telegram User ID 1 : <input type="text" name="telegramID1">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_ID_1">Nothing
            here</span>
        </form>
        <form action="/get">
          Telegram User ID 2 : <input type="text" name="telegramID2">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_ID_2">Nothing
            here</span>
        </form>
        <form action="/get">
          Telegram User ID 3 : <input type="text" name="telegramID3">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_ID_3">Nothing
            here</span>
        </form>
        <form action="/get">
          Telegram User ID 4 : <input type="text" name="telegramID4">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_ID_4">Nothing
            here</span>
        </form>
        <form action="/get">
          Telegram User ID 5 : <input type="text" name="telegramID5">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_ID_5">Nothing
            here</span>
        </form>
        <form action="/get">
          Telegram Bot Token : <input type="text" name="telegramToken">
          <input type="submit" value="Submit"><strong> Saved value : </strong><span id="Telegram_TOKEN">Nothing
            here</span>
        </form>
      </div>
    </div>
  </div>
</body>

<script>

  $('a[data-toggle=\"tab\"]').on('shown.bs.tab', function (e) {
    //On supprime tous les timers lorsqu'on change d'onglet
    clearTimeout(Timer_UdpateMesures);
    tab_pane = $(e.target).attr("href")
    console.log('activated ' + tab_pane);

    // IE10, Firefox, Chrome, etc.
    if (history.pushState)
      window.history.pushState(null, null, tab_pane);
    else
      window.location.hash = tab_pane;
  });

  function update() {
    $.getJSON('config/config.json', function (data) {
      $('#mqttServer').html(data.mqttServer);
      $('#hostname').html(data.hostname);
      $('#Telegram_ID_1').html(data.Telegram_ID_1);
      $('#Telegram_ID_2').html(data.Telegram_ID_2);
      $('#Telegram_ID_3').html(data.Telegram_ID_3);
      $('#Telegram_ID_4').html(data.Telegram_ID_4);
      $('#Telegram_ID_5').html(data.Telegram_ID_5);
      $('#Telegram_TOKEN').html(data.Telegram_TOKEN);
      $('#Topic_DHT11_Temperature').html(data.Topic_DHT11_Temperature);
      $('#Topic_DHT11_Humidity').html(data.Topic_DHT11_Humidity);
      $('#Topic_SoilMoisture').html(data.Topic_SoilMoisture);
    }).fail(function (err) {
      console.log("err getJSON config.json " + JSON.stringify(err));
    });
  };

  function Activation_DHT11() {
    var x = document.getElementById("div_DHT11");
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }
    update();
  }

  function Activation_SoilMoisture() {
    var x = document.getElementById("div_SoilMoisture");
    if (x.style.display === "none") {
      x.style.display = "block";
    } else {
      x.style.display = "none";
    }
    update();
  }

  function ShowAll() {
    Activation_DHT11();
    Activation_SoilMoisture();
    update();
  }

  //Change current theme
  var supports_storage = supports_html5_storage();
  if (supports_storage) {
    var theme = localStorage.theme;
    console.log("theme reload " + theme);
    if (theme) {
      set_theme(get_themeUrl(theme));
    }
  }

  setInterval(function getData() {
    var xhttp = new XMLHttpRequest();

    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("Temps").innerHTML = this.responseText;
      }
    };

    xhttp.open("GET", "Temps", true);
    xhttp.send();

    var xhttp = new XMLHttpRequest();

    xhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        document.getElementById("InternalTemp").innerHTML = this.responseText;
      }
    };

    xhttp.open("GET", "InternalTemp", true);
    xhttp.send();
    update();
  }, 2000);

  //New theme selected
  jQuery(function ($) {
    $('body').on('click', '.change-style-menu-item', function () {
      var theme_name = $(this).attr('rel');
      console.log("Change theme " + theme_name);
      var theme_url = get_themeUrl(theme_name);
      console.log("URL theme : " + theme_url);
      set_theme(theme_url);
    });
  });
  // Recupere l'adresse du theme - Get theme URL
  function get_themeUrl(theme_name) {
    $('#labelTheme').html("Th&egrave;me : " + theme_name);
    var url_theme = "";
    if (theme_name === "bootstrap") {
      url_theme = "https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css";
    } else {
      url_theme = "https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/" + theme_name + "/bootstrap.min.css";
    }
    if (supports_storage) {
      // Enregistre le theme sélectionné en local - save into the local database the selected theme
      localStorage.theme = theme_name;
    }
    return url_theme;
  }
  // Applique le thème - Apply theme
  function set_theme(theme_url) {
    $('link[title="main"]').attr('href', theme_url);
  }
  // Stockage local disponible ? - local storage available ?
  function supports_html5_storage() {
    try {
      return 'localStorage' in window && window['localStorage'] !== null;
    } catch (e) {
      return false;
    }
  }

</script>

</html>